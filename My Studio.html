<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tenshi | Noticias</title>
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      background: #0b0b0b;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    /* === HERO / BANNER PRINCIPAL === */
    .hero-wrapper { position: relative; height: 70vh; overflow: hidden; }
    .hero-bg {
      position: absolute; inset: 0;
      background-size: cover; background-position: center; z-index: 0;
      pointer-events: none; /* evita que tape clics */
    }
    .hero-text {
      position: relative; z-index: 2; color: white; font-size: 2rem;
      padding: 60px 5%; height: 100%; display: flex; align-items: center;
      text-shadow: 0 2px 10px rgba(0,0,0,.6);
    }

    /* === SECCIÓN NOTICIAS === */
    .news {
      position: relative; z-index: 5;
      padding: 100px 5% 80px; background-color: #1a1a1a;
      max-width: 1200px; margin: -50px auto 80px; border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,0,0,.3);
    }
    .news h2 { font-size: 32px; color: #fff; margin-bottom: 30px; text-align: center; }
    .schedule-grid {
      display: grid; grid-template-columns: 2fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 20px;
    }
    /* Tarjetas como enlaces clickeables */
    .main-news, .news-card {
      display: block; background: #222; color: inherit; text-decoration: none;
      border-radius: 16px; padding: 20px; overflow: hidden;
    }
    .main-news { grid-column: 1 / 2; grid-row: 1 / 3; }
    .news-card  { border-radius: 14px; cursor: pointer; aspect-ratio: 1 / 1; transition: transform .3s ease; }
    .news-card:hover { transform: scale(1.05); }
    .news-card img, .main-news img {
      width: 100%; height: 100%; object-fit: cover; border-radius: 10px; margin-bottom: 10px; display: block;
    }

    /* === SECCIÓN VIDEOS === */
    .videos {
      position: relative; z-index: 5;
      padding: 100px 5% 80px; background-color: #1a1a1a;
      max-width: 1200px; margin: -50px auto 80px; border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,0,0,.3);
    }
    .videos h2 { font-size: 32px; color: #fff; margin-bottom: 30px; text-align: center; }
    .video-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .video-card { background: #222; border-radius: 14px; padding: 10px; overflow: hidden; aspect-ratio: 16/9; }
    .video-card iframe { width: 100%; height: 100%; border: none; border-radius: 10px; }
  </style>
</head>
<body>
  <!-- Banner dinámico -->
  <div class="hero-wrapper">
    <div class="hero-bg" id="banner"></div>
    <div class="hero-text">Bienvenido a Tenshi | 幻想の響き</div>
  </div>

  <!-- Noticias -->
  <section class="news">
    <h2>NEWS</h2>
    <div class="schedule-grid" id="news-grid">
      <!-- Noticias dinámicas desde catalogo.json -->
    </div>
  </section>

  <!-- Videos -->
  <section class="videos">
    <h2>VIDEOS</h2>
    <div class="video-grid" id="video-grid">
      <!-- Videos dinámicos desde catalogo.json -->
    </div>
  </section>

  <script>
    /* Solo estas secciones (news → URL absoluta que me diste) */
    const SECTION_MAP = {
      discografia: 'Discography.html',                         // o '#discography' si es misma página
      movie:       'movie.html',                               // o '#videos'
      news:        'https://jtenshix.github.io/J-tenshi-music/news.html'
    };

    function resolveDestino(nota) {
      // 1) link directo
      if (nota && typeof nota.link === 'string' && nota.link.trim()) return nota.link.trim();
      // 2) destino por alias reconocido
      if (nota && typeof nota.destino === 'string' && nota.destino.trim()) {
        const key = nota.destino.trim().toLowerCase();
        if (SECTION_MAP[key]) return SECTION_MAP[key];
        // si ya viene hash/URL válido, úsalo tal cual
        if (key.startsWith('#') || key.startsWith('/') || key.includes('.html') || key.startsWith('http')) return key;
      }
      // fallback
      return '#';
    }

    async function cargarCatalogo() {
      try {
        const response = await fetch("data/catalogo.json", { cache: "no-store" });
        const data = await response.json();

        // Banner principal
        const banner = document.getElementById("banner");
        if (data.banner_principal) {
          banner.style.backgroundImage = `url('${data.banner_principal}')`;
        }

        // Noticias (enlaces clickeables)
        const grid = document.getElementById("news-grid");
        grid.innerHTML = "";
        const notas = Object.values(data.news || {});
        notas.forEach((nota, idx) => {
          const destino = resolveDestino(nota);
          const a = document.createElement("a");
          a.href = destino;
          a.className = idx === 0 ? "main-news" : "news-card";
          a.setAttribute("aria-label", `Abrir: ${nota?.titulo || nota?.destino || 'noticia'}`);
          a.innerHTML = `<img src="${nota.imagen}" alt="${nota?.titulo || 'Noticia'}">`;
          grid.appendChild(a);
        });

        // Videos (ya en formato /embed/)
        const videoGrid = document.getElementById("video-grid");
        videoGrid.innerHTML = "";
        (data.videos || []).forEach(video => {
          const embedUrl = video.url || "";
          const card = document.createElement("div");
          card.className = "video-card";
          card.innerHTML = `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
          videoGrid.appendChild(card);
        });

      } catch (e) {
        console.error("Error cargando catálogo:", e);
      }
    }

    cargarCatalogo();
  </script>
</body>
</html>
