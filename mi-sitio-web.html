<!DOCTYPE html> 
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenshi | 幻想の響き</title>
    <style>
        /* (Todos los estilos CSS se mantienen igual) */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">Tenshi</div>
        <nav>
            <ul>
                <li><a href="news.html">News</a></li>
                <li><a href="Discography.html" id="link-discography">Discography</a></li>
                <li><a href="movie.html">Videos</a></li>
                <li><a href="wallpapers.html">Gallery</a></li>
                <li><a href="My Studio.html">My Studio</a></li>
            </ul>
        </nav>
        <button class="theme-toggle" onclick="toggleTheme()">Modo Claro / Oscuro</button>
    </header>
    <div class="hero-wrapper">
        <div class="hero-bg" id="main-banner"></div>
        <div class="hero-text">Bienvenido a Tenshi | 幻想の響き</div>
    </div>
    <!-- Contenido adicional -->
    <div class="contenedor-centrado">
        <!-- Redes sociales -->
    </div>
    <section class="news" id="news">
        <!-- Sección de noticias -->
    </section>
    <div class="section-banner" id="discography-banner">ディスコグラフィー</div>
    <section class="discography" id="discography">
        <div class="carousel-container" aria-label="Discography carousel">
            <div class="carousel-track" id="discography-track"></div>
            <button class="carousel-btn prev" aria-label="Anterior">‹</button>
            <button class="carousel-btn next" aria-label="Siguiente">›</button>
        </div>
    </section>
    <div class="section-banner" id="video-banner">ビデオ</div>
    <section class="videos" id="videos">
        <div class="carousel-container" aria-label="Videos carousel">
            <div class="carousel-track" id="videos-track"></div>
            <button class="carousel-btn prev" aria-label="Anterior">‹</button>
            <button class="carousel-btn next" aria-label="Siguiente">›</button>
        </div>
    </section>
    <footer>
        <div class="social-bar"></div>
        <p>j-tenshiwebcomingsoon</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/basiclightbox@5.0.4/dist/basicLightbox.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basiclightbox@5.0.4/dist/basicLightbox.min.css">
    <script>
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        }
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
        }

        // Función para cargar los videos de YouTube en el carrusel de videos
        async function loadYouTubeVideos() {
            try {
                const response = await fetch('/.netlify/functions/youtube');
                const videos = await response.json();

                const videosTrack = document.getElementById('videos-track');
                videosTrack.innerHTML = '';

                videos.forEach(video => {
                    const iframe = document.createElement('iframe');
                    iframe.src = `https://www.youtube.com/embed/${video.id}`;
                    iframe.width = '400';
                    iframe.height = '300';
                    iframe.frameBorder = '0';
                    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                    iframe.allowFullscreen = true;

                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'media-card';
                    videoContainer.appendChild(iframe);

                    videosTrack.appendChild(videoContainer);
                });
                initCarousel({
                    trackId: 'videos-track',
                    prevSelector: '.videos .carousel-btn.prev',
                    nextSelector: '.videos .carousel-btn.next'
                });
            } catch (error) {
                console.error('Error al cargar los videos:', error);
            }
        }

        // Función para cargar las imágenes de la discografía en el carrusel de discografía
        async function loadDiscographyImages() {
            try {
                const response = await fetch('/.netlify/functions/gdrive?type=discography');
                const images = await response.json();

                const discographyTrack = document.getElementById('discography-track');
                discographyTrack.innerHTML = '';

                images.forEach(image => {
                    const img = document.createElement('img');
                    img.src = image.url;
                    img.alt = image.title || 'Portada de álbum';
                    img.className = 'media-card';

                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'media-card';
                    imgContainer.appendChild(img);

                    discographyTrack.appendChild(imgContainer);
                });
                initCarousel({
                    trackId: 'discography-track',
                    prevSelector: '.discography .carousel-btn.prev',
                    nextSelector: '.discography .carousel-btn.next'
                });
            } catch (error) {
                console.error('Error al cargar las imágenes de discografía:', error);
            }
        }

        // Función para cargar el banner principal
        async function loadMainBanner() {
            try {
                const response = await fetch('/.netlify/functions/gdrive?type=banner');
                const banner = await response.json();

                const mainBanner = document.getElementById('main-banner');
                mainBanner.innerHTML = '';

                const img = document.createElement('img');
                img.src = banner.url;
                img.alt = banner.title || 'Banner principal';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';

                mainBanner.appendChild(img);
            } catch (error) {
                console.error('Error al cargar el banner principal:', error);
            }
        }

        // Función para cargar el banner de videos
        async function loadVideoBanner() {
            try {
                const response = await fetch('/.netlify/functions/gdrive?type=video-banner');
                const videoBanner = await response.json();

                const videoBannerElement = document.getElementById('video-banner');
                videoBannerElement.style.background = `url('${videoBanner.url}') center center no-repeat`;
                videoBannerElement.style.backgroundSize = 'cover';
            } catch (error) {
                console.error('Error al cargar el banner de videos:', error);
            }
        }

        // Función para cargar el banner de discografía
        async function loadDiscographyBanner() {
            try {
                const response = await fetch('/.netlify/functions/gdrive?type=discography-banner');
                const discographyBanner = await response.json();

                const discographyBannerElement = document.getElementById('discography-banner');
                discographyBannerElement.style.background = `url('${discographyBanner.url}') center center no-repeat`;
                discographyBannerElement.style.backgroundSize = 'cover';
            } catch (error) {
                console.error('Error al cargar el banner de discografía:', error);
            }
        }

        // Función para inicializar el carrusel
        function initCarousel(options) {
            const track = document.getElementById(options.trackId);
            const prevBtn = document.querySelector(options.prevSelector);
            const nextBtn = document.querySelector(options.nextSelector);
            const container = track ? track.parentElement : null;
            if (!track || !prevBtn || !nextBtn || !container) return;
            let isTransitioning = false;
            let cards = Array.from(track.children);
            const totalCards = cards.length;
            if (totalCards <= 1) return;
            function updateCarousel(smoothTransition = true) {
                if (isTransitioning) return;
                isTransitioning = true;
                const card = cards[Math.floor(cards.length / 2)];
                if (!card) {
                    isTransitioning = false;
                    return;
                }
                const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
                const containerCenter = container.offsetWidth / 2;
                const newTransform = -(cardCenter - containerCenter);
                track.style.transition = smoothTransition ? 'transform 0.5s ease-in-out' : 'none';
                track.style.transform = `translateX(${newTransform}px)`;
                cards.forEach(c => c.classList.remove('center-card'));
                card.classList.add('center-card');
                setTimeout(() => {
                    isTransitioning = false;
                }, 500);
            }
            prevBtn.addEventListener('click', () => {
                if (isTransitioning) return;
                const firstCard = cards[0];
                track.appendChild(firstCard);
                cards = Array.from(track.children);
                updateCarousel();
            });
            nextBtn.addEventListener('click', () => {
                if (isTransitioning) return;
                const lastCard = cards[cards.length - 1];
                track.prepend(lastCard);
                cards = Array.from(track.children);
                updateCarousel();
            });
            let autoplayInterval = setInterval(() => {
                if (!isTransitioning) {
                    const lastCard = cards[cards.length - 1];
                    track.prepend(lastCard);
                    cards = Array.from(track.children);
                    updateCarousel();
                }
            }, 4000);
            container.addEventListener('mouseenter', () => clearInterval(autoplayInterval));
            container.addEventListener('mouseleave', () => {
                autoplayInterval = setInterval(() => {
                    if (!isTransitioning) {
                        const lastCard = cards[cards.length - 1];
                        track.prepend(lastCard);
                        cards = Array.from(track.children);
                        updateCarousel();
                    }
                }, 4000);
            });
            updateCarousel();
            window.addEventListener('resize', () => updateCarousel(false));
        }

        // Cargar todo el contenido dinámico cuando se cargue la página
        window.onload = function() {
            loadYouTubeVideos();
            loadDiscographyImages();
            loadMainBanner();
            loadVideoBanner();
            loadDiscographyBanner();
        };
    </script>
</body>
</html>
