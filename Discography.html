<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tenshi — Discography</title>

<style>
  :root { color-scheme: dark; }
  *{box-sizing:border-box}
  body{
    margin:0; background:#0b0b0b; color:#eee;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  }
  a{ color:inherit; }

  /* Cabecera */
  .hero{
    max-width:980px; margin:48px auto 10px; padding:0 16px; text-align:center;
  }
  .title{
    font-size:34px; font-weight:900; letter-spacing:.5px; margin:16px 0 4px;
  }
  .subtitle{ opacity:.7; font-size:12px; letter-spacing: .2em; }

  /* Banner artista */
  .artist-wrap{
    max-width:980px; margin:16px auto 24px; padding:0 16px;
  }
  .artist-card{
    background:linear-gradient(135deg,#151515,#0f0f0f); border:1px solid #222;
    border-radius:14px; padding:14px; box-shadow:0 16px 40px rgba(0,0,0,.4);
  }
  .artist-head{ display:flex; align-items:center; gap:12px; margin-bottom:10px; }
  .artist-dot{ width:10px; height:10px; border-radius:999px; background:#ffcc70; }
  .artist-title{ font-weight:800; letter-spacing:.5px; }

  /* Filtros (opcionales) */
  .filters{
    display:flex; gap:8px; justify-content:center; flex-wrap:wrap;
    margin:16px auto 26px;
  }
  .chip{
    border:1px solid #2a2a2a; background:#121212; color:#dfe6eb;
    padding:6px 10px; border-radius:999px; font-size:12px; cursor:pointer;
  }
  .chip.active{ border-color:#ffcc70; color:#111; background:#ffcc70; }

  /* Grilla */
  .grid{
    max-width:980px; margin:0 auto 80px; padding:0 16px;
    display:grid; grid-template-columns: repeat(3, 1fr); gap:28px 24px;
  }
  @media (max-width:900px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
  @media (max-width:580px){ .grid{ grid-template-columns: 1fr; } }

  .card{
    background:#111; border:1px solid #222; border-radius:12px; overflow:hidden;
    box-shadow:0 16px 40px rgba(0,0,0,.4);
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .card:hover{ transform:translateY(-2px); box-shadow:0 22px 46px rgba(0,0,0,.55); }
  .thumb{
    position:relative; width:100%; aspect-ratio:1 / 1; background:#0e0e0e;
    background-size:cover; background-position:center;
  }
  .meta{ padding:10px 12px 12px; text-align:center; }
  .date{ opacity:.6; font-size:10px; margin-bottom:6px; }
  .name{ font-size:13px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  /* Modal */
  .modal{
    position:fixed; inset:0; display:none; place-items:center;
    background:rgba(0,0,0,.65); z-index:50; padding:20px;
  }
  .modal.open{ display:grid; }
  .sheet{
    width:min(980px, 96vw); background:#0f0f0f; border:1px solid #222; border-radius:14px;
    box-shadow:0 30px 80px rgba(0,0,0,.7); overflow:hidden;
  }
  .sheet-head{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 16px; border-bottom:1px solid #202020; background:#111;
  }
  .sheet-title{ font-weight:800; font-size:16px }
  .close{ border:none; border-radius:8px; background:#222; color:#eee; padding:6px 10px; cursor:pointer; }
  .close:hover{ background:#333; }
  .sheet-body{
    display:grid; grid-template-columns: 1.1fr 1fr; gap:14px; padding:16px;
  }
  @media (max-width:820px){ .sheet-body{ grid-template-columns: 1fr; } }

  .cover{
    width:100%; aspect-ratio:1/1; border-radius:10px; border:1px solid #222;
    background:#0d0d0d center/cover no-repeat;
  }
  .player{
    background:#111; border:1px solid #222; border-radius:12px; padding:12px;
  }
  .player h4{ margin:0 0 12px; font-size:14px; opacity:.9 }
  .note{ font-size:12px; opacity:.7; margin-top:10px }
</style>
</head>
<body>

  <!-- Cabecera -->
  <div class="hero">
    <div class="title">DISCOGRAPHY</div>
    <div class="subtitle">ディスコグラフィー</div>
  </div>

  <!-- Banner de artista (usa tu ID y muestra tus popular tracks) -->
  <section class="artist-wrap">
    <div class="artist-card">
      <div class="artist-head">
        <div class="artist-dot"></div>
        <div class="artist-title">Tenshi — Spotify Artist</div>
      </div>
      <!-- Cambia el ARTIST_ID abajo en JS si lo necesitas -->
      <iframe id="artistEmbed" style="border-radius:12px" src="" width="100%" height="200" frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
      <div class="note">Este módulo muestra tus temas populares del perfil de artista.</div>
    </div>
  </section>

  <!-- Filtros opcionales -->
  <div class="filters" id="filters">
    <button class="chip active" data-type="all">ALL</button>
    <button class="chip" data-type="digital">DIGITAL</button>
    <button class="chip" data-type="single">SINGLE</button>
    <button class="chip" data-type="ep">EP</button>
    <button class="chip" data-type="album">ALBUM</button>
  </div>

  <!-- Grilla -->
  <div class="grid" id="grid"></div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="sheet">
      <div class="sheet-head">
        <div class="sheet-title" id="mTitle">Track title</div>
        <button class="close" id="btnClose">✕</button>
      </div>
      <div class="sheet-body">
        <div class="cover" id="mCover"></div>
        <div class="player" id="mPlayer"></div>
      </div>
    </div>
  </div>

<script>
/* ========= CONFIG ========= */
const ARTIST_ID = '0ZkxChUDjvBph9f7TitfMR'; // Tu ID de artista
document.getElementById('artistEmbed').src =
  `https://open.spotify.com/embed/artist/${ARTIST_ID}?utm_source=generator&theme=0`;

/* Pega aquí tus links de Spotify (pista, álbum o playlist).
   El código llamará al oEmbed público para sacar título/miniatura.
   Ejemplos comentados: reemplázalos por tus URLs reales. */
const SPOTIFY_URLS = [
  // "https://open.spotify.com/track/xxxxxxxxxxxxxxxxxxxxxx",
  // "https://open.spotify.com/album/xxxxxxxxxxxxxxxxxxxxxx",
  // "https://open.spotify.com/track/yyyyyyyyyyyyyyyyyyyyyy",
];

/* Si quieres clasificar por tipo, puedes mutar aquí:
   Por defecto, todas se marcarán "single". */
const DEFAULT_TYPE = 'single';

/* ========= Estado ========= */
const grid = document.getElementById('grid');
const filters = document.getElementById('filters');
const modal = document.getElementById('modal');
const mTitle = document.getElementById('mTitle');
const mCover = document.getElementById('mCover');
const mPlayer = document.getElementById('mPlayer');
document.getElementById('btnClose').onclick = ()=> closeModal();
modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

let ITEMS = [];       // tarjetas construidas con oEmbed
let currentType = 'all';

/* ========= Utilidades ========= */
function formatDateIsoToNice(s){
  if(!s) return '';
  try{
    const d = new Date(s);
    return d.toLocaleDateString('es-CL', { year: 'numeric', month: 'short', day: '2-digit' });
  }catch{ return s; }
}
function toSpotifyEmbed(url, theme='dark', height=152){
  const m = String(url).match(/^https?:\/\/open\.spotify\.com\/(?:intl-[^/]+\/)?(track|album|artist|playlist)\/([A-Za-z0-9]+)(?:\?.*)?$/);
  if(!m) return null;
  const type = m[1], id = m[2];
  const themeParam = (theme==='light') ? '1' : '0';
  return `https://open.spotify.com/embed/${type}/${id}?utm_source=generator&theme=${themeParam}`;
}

/* ========= Render ========= */
function renderGrid(){
  const list = ITEMS.filter(it => currentType==='all' ? true : (it.type===currentType));
  grid.innerHTML = '';
  list.forEach((it, i) => {
    const card = document.createElement('button');
    card.className = 'card';
    card.style.cursor = 'pointer';
    card.setAttribute('aria-label', `Abrir ${it.title}`);
    card.innerHTML = `
      <div class="thumb" style="background-image:url('${it.cover}')"></div>
      <div class="meta">
        <div class="date">${formatDateIsoToNice(it.date)}</div>
        <div class="name" title="${it.title}">${it.title}</div>
      </div>
    `;
    card.addEventListener('click', () => openModal(it));
    grid.appendChild(card);
  });
}

/* Modal */
function closeModal(){
  modal.classList.remove('open');
  mPlayer.innerHTML = '';
}
function openModal(item){
  mTitle.textContent = item.title || 'Track';
  mCover.style.backgroundImage = `url('${item.cover}')`;
  mPlayer.innerHTML = '';

  const src = toSpotifyEmbed(item.urlSpotify || '');
  if(src){
    mPlayer.innerHTML = `
      <h4>Reproducir</h4>
      <iframe style="border-radius:12px" src="${src}" width="100%" height="152"
        frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy"></iframe>
      <p class="note">Vista previa de Spotify (si la sesión está iniciada podrás escuchar completa según permisos/licencias).</p>
    `;
  }else{
    mPlayer.innerHTML = `<p class="note">Este ítem no tiene URL de Spotify válida.</p>`;
  }

  modal.classList.add('open');
}

/* ========= Filtros ========= */
filters.addEventListener('click', (e)=>{
  const btn = e.target.closest('.chip'); if(!btn) return;
  filters.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  btn.classList.add('active');
  currentType = btn.dataset.type || 'all';
  renderGrid();
});

/* ========= Cargar desde oEmbed (sin API/token) =========
   Para cada URL de Spotify traemos metadatos: título y thumbnail. */
async function loadFromSpotifyOEmbed(urls) {
  const out = [];
  for (const url of urls) {
    try{
      const res = await fetch(`https://open.spotify.com/oembed?url=${encodeURIComponent(url)}`);
      if(!res.ok) continue;
      const js = await res.json();
      out.push({
        type: DEFAULT_TYPE,                    // cámbialo si quieres clasificar distinto
        title: js.title || 'Sin título',
        date: '',                              // si quieres, puedes setear fechas manualmente
        cover: js.thumbnail_url || '',         // miniatura desde oEmbed
        urlSpotify: url
      });
    }catch(e){
      console.warn('oEmbed falló para', url, e);
    }
  }
  return out;
}

/* ========= Init ========= */
(async function init(){
  // Construir tarjetas desde tus URLs
  ITEMS = await loadFromSpotifyOEmbed(SPOTIFY_URLS);
  renderGrid();
})();
</script>
</body>
</html>
