<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tenshi | Discografía</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --bg:#0b0b0b; --ink:#f5f5f5; --muted:#b7b7b7;
      --card:#161616; --bd:#242424; --gold:#e0c27b;
      --accent:#4c51bf;
    }
    *{box-sizing:border-box; margin:0; padding:0}
    body{font-family:'Helvetica Neue', system-ui, Arial, sans-serif; background:var(--bg); color:var(--ink);}

    header{
      position: sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 20px; background:rgba(0,0,0,.8); backdrop-filter: blur(10px);
      border-bottom:1px solid #111;
    }
    header .logo{font-weight:800; letter-spacing:.5px}
    nav ul{list-style:none; display:flex; gap:18px}
    nav a{color:#cfcfcf; text-decoration:none; font-size:14px}
    nav a:hover{color:var(--gold)}

    .hero{
      height:220px; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(60% 100% at 50% 0%, #1a1a1a 0%, #0b0b0b 70%);
      border-bottom: 1px solid #111;
    }
    .hero h1{
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: .5px;
      color:#fff; text-shadow: 0 0 18px rgba(0,0,0,.35);
    }
    .hero h1 .jp{
      font-size:.55em; color:#cfcfcf; font-weight:500; margin-left:10px;
    }

    .wrap{max-width:1200px; margin:28px auto 80px; padding:0 16px;}

    /* Grid de portadas */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap:18px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--bd);
      border-radius:14px;
      overflow:hidden;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color:#2f2f2f;
      box-shadow: 0 10px 28px rgba(0,0,0,.45);
    }
    .thumb{
      width:100%; aspect-ratio:1/1;
      background:#0f0f0f center/cover no-repeat;
    }
    .meta{
      padding:12px 12px 14px;
      display:flex; flex-direction:column; gap:6px;
    }
    .title{
      font-size:14px; font-weight:700; color:#fff;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .links{display:flex; gap:8px; align-items:center}
    .tag{
      font-size:11px; color:#ddd; background:#111; border:1px solid #202020;
      padding:3px 8px; border-radius:999px; display:inline-flex; gap:6px; align-items:center;
    }
    .tag i{font-size:12px; opacity:.85}

    /* Modal (ventana emergente) */
    .modal{
      position: fixed; inset:0; z-index:100;
      display:none; align-items:center; justify-content:center;
      padding:16px;
    }
    .modal.open{ display:flex; }
    .backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
    }
    .dialog{
      position: relative; z-index:2;
      width:min(960px, 96vw);
      background: #0f0f0f;
      border:1px solid #1f1f1f;
      border-radius:16px;
      overflow:hidden;
      box-shadow: 0 30px 80px rgba(0,0,0,.6);
      display:grid;
      grid-template-columns: 1.2fr 1fr;
    }
    @media (max-width: 860px){
      .dialog{ grid-template-columns: 1fr; }
    }
    .left{
      background: #0a0a0a;
      padding:18px;
      display:flex; align-items:center; justify-content:center;
    }
    .bigcover{
      width:100%; max-width:560px; aspect-ratio:1/1;
      background:#0c0c0c center/cover no-repeat;
      border-radius:12px; border:1px solid #1e1e1e;
      box-shadow: inset 0 0 0 1px #0006;
    }
    .right{
      padding:20px 20px 16px;
      display:flex; flex-direction:column; gap:14px;
    }
    .modal-title{
      font-size:18px; font-weight:800; color:#fff;
    }
    .byline{font-size:13px; color:#bdbdbd}
    .audio-wrap{
      background:#121212; border:1px solid #1f1f1f;
      padding:14px; border-radius:12px;
    }
    audio{ width:100%; outline:none; }
    .helper{
      font-size:13px; color:#bbb; line-height:1.5;
      background:#101010; border:1px dashed #242424; padding:10px; border-radius:10px;
    }
    .btns{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:4px;
    }
    .btn{
      border:none; cursor:pointer;
      background: #fff; color:#000;
      border-radius:10px; padding:9px 14px; font-weight:700; font-size:14px;
      transition: .16s ease; text-decoration:none; display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.gold{ background: var(--gold); color:#1a1a1a; }
    .btn.ghost{ background:#161616; color:#ddd; border:1px solid #2a2a2a; }
    .close{
      position:absolute; top:10px; right:10px;
      background:#111; color:#ddd; border:1px solid #2b2b2b;
      border-radius:10px; padding:8px 10px; cursor:pointer; z-index:3;
    }
    .close:hover{ background:#151515 }

    footer{ padding:60px 0 40px; text-align:center; color:#aaa; }
  </style>
</head>
<body>

  <header>
    <div class="logo">Tenshi</div>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="news.html">News</a></li>
        <li><a href="movie.html">Videos</a></li>
        <li><a href="wallpapers.html">Gallery</a></li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <h1>Discografía <span class="jp">ディスコグラフィー</span></h1>
  </section>

  <main class="wrap">
    <div id="grid" class="grid">
      <!-- Tarjetas generadas desde data/songs.json -->
    </div>
  </main>

  <!-- MODAL -->
  <div id="modal" class="modal" aria-hidden="true" role="dialog">
    <div class="backdrop" data-close></div>

    <div class="dialog">
      <button class="close" title="Cerrar (Esc)" data-close>&times;</button>

      <div class="left">
        <div id="bigcover" class="bigcover"></div>
      </div>

      <div class="right">
        <div class="modal-title" id="mTitle">Título de la canción</div>
        <div class="byline" id="mSub">Audio integrado o enlace a plataformas</div>

        <div class="audio-wrap" id="audioBlock" style="display:none;">
          <audio id="player" controls preload="none"></audio>
        </div>

        <div class="helper" id="noAudio" style="display:none;">
          Esta canción no tiene un <b>audio directo</b> configurado.
          Puedes abrirla en YouTube para escucharla.
        </div>

        <div class="btns">
          <a id="btnYT" class="btn gold" href="#" target="_blank" rel="noopener">
            <i class="fab fa-youtube"></i> Abrir en YouTube
          </a>
          <a id="btnCover" class="btn ghost" href="#" target="_blank" rel="noopener">
            <i class="fa fa-image"></i> Ver portada
          </a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    j-tenshiwebcomingsoon
  </footer>

  <script>
    // Carga de canciones
    const grid = document.getElementById('grid');
    const modal = document.getElementById('modal');
    const bigcover = document.getElementById('bigcover');
    const mTitle = document.getElementById('mTitle');
    const mSub = document.getElementById('mSub');
    const player = document.getElementById('player');
    const audioBlock = document.getElementById('audioBlock');
    const noAudio = document.getElementById('noAudio');
    const btnYT = document.getElementById('btnYT');
    const btnCover = document.getElementById('btnCover');

    let SONGS = [];

    function makeCard(song, idx){
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('tabindex', '0');
      card.innerHTML = `
        <div class="thumb" style="background-image:url('${song.cover || ''}')"></div>
        <div class="meta">
          <div class="title" title="${song.title || ''}">${song.title || 'Sin título'}</div>
          <div class="links">
            ${song.youtube ? `<span class="tag"><i class="fab fa-youtube"></i>YouTube</span>` : ''}
            ${song.audio ? `<span class="tag"><i class="fa fa-music"></i>Audio</span>` : ''}
          </div>
        </div>
      `;
      card.addEventListener('click', () => openModal(idx));
      card.addEventListener('keydown', (e) => { if(e.key === 'Enter') openModal(idx); });
      return card;
    }

    async function loadSongs(){
      try{
        const resp = await fetch('data/songs.json', { cache: 'no-store' });
        const json = await resp.json();
        SONGS = Array.isArray(json.songs) ? json.songs : [];

        grid.innerHTML = '';
        SONGS.forEach((s, i) => grid.appendChild(makeCard(s, i)));
      }catch(err){
        console.error('No se pudo cargar data/songs.json', err);
        grid.innerHTML = '<p style="opacity:.8">No pude cargar <code>data/songs.json</code>.</p>';
      }
    }

    function openModal(index){
      const s = SONGS[index] || {};
      mTitle.textContent = s.title || 'Sin título';
      mSub.textContent = (s.audio ? 'Reproductor integrado' : 'Enlace externo');

      // Portada grande
      bigcover.style.backgroundImage = `url('${s.cover || ''}')`;

      // Configurar reproductor de audio
      player.pause();
      player.removeAttribute('src');
      audioBlock.style.display = 'none';
      noAudio.style.display = 'none';

      if (s.audio && typeof s.audio === 'string' && s.audio.trim() !== '') {
        audioBlock.style.display = 'block';
        player.src = s.audio.trim();   // Debe ser un .mp3/.ogg directo con CORS
        // autoplay tras el click del usuario que abrió el modal
        setTimeout(() => {
          player.play().catch(()=>{ /* si el navegador bloquea autoplay, el usuario deberá pulsar play */ });
        }, 60);
      } else {
        noAudio.style.display = 'block';
      }

      // Botones
      btnYT.style.display = s.youtube ? 'inline-flex' : 'none';
      if (s.youtube) btnYT.href = s.youtube;

      btnCover.href = s.cover || '#';

      // Abrir
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(){
      player.pause();
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    // Cerrar con backdrop o botón
    modal.addEventListener('click', (e) => {
      if (e.target.matches('[data-close]')) closeModal();
    });
    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('open')) closeModal();
    });

    loadSongs();
  </script>
</body>
</html>
