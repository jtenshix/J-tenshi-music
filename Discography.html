<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tenshi | Discografía</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    :root { --ang: 0 }

    body {
      font-family: 'Helvetica Neue', system-ui, sans-serif;
      background:#0b0b0b; color:#f5f5f5;
      overflow-x:hidden;
    }

    header{
      position:fixed; top:0; left:0; right:0; z-index:10;
      display:flex; justify-content:space-between; align-items:center;
      padding:16px 5%; background:rgba(0,0,0,.75); backdrop-filter:blur(10px);
    }
    header .logo{ letter-spacing:2px }
    header a{ color:#ddd; text-decoration:none; margin-left:18px; font-size:14px }
    header a:hover{ color:#e0c27b }

    .hero { height:40vh; display:flex; align-items:center; justify-content:center;
      margin-top:68px; background:#111; position:relative; overflow:hidden; }
    .hero h1{ font-size:2.2rem; letter-spacing:2px }

    /* === DISCOS (carrusel 3D) === */
    .discography { display:flex; flex-direction:column; align-items:center; padding:60px 0 100px }
    .container { display:flex; align-items:center; justify-content:center; position:relative }
    .holder {
      width: 600px; height: 220px;
      display:flex; align-items:center; justify-content:center;
      perspective:700px; perspective-origin:center; position:relative; z-index:1;
    }
    .spinner {
      transform-style:preserve-3d; position:relative; display:flex;
      align-items:center; justify-content:center;
      transform: rotateY(calc(var(--ang) * 1deg)) translateY(-8px);
      transition: all .5s ease-in-out;
    }
    .panel {
      width:130px; height:130px; border-radius:12px; position:absolute;
      background-size:cover; background-position:50% 50%;
      box-shadow:0 10px 30px rgba(0,0,0,.6);
      opacity:1; transition: all .5s ease-in-out, opacity .2s ease-out;
      cursor:pointer; outline:none; border:0;
    }
    .panel:focus { box-shadow:0 0 0 3px #ffe1a255 }
    /* posiciones (15 x 24°) */
    .spinner .panel:nth-child(1)  { transform: rotateY(0deg) translateZ(400px) }
    .spinner .panel:nth-child(2)  { transform: rotateY(24deg) translateZ(400px) }
    .spinner .panel:nth-child(3)  { transform: rotateY(48deg) translateZ(400px) }
    .spinner .panel:nth-child(4)  { transform: rotateY(72deg) translateZ(400px) }
    .spinner .panel:nth-child(5)  { transform: rotateY(96deg) translateZ(400px) }
    .spinner .panel:nth-child(6)  { transform: rotateY(120deg) translateZ(400px) }
    .spinner .panel:nth-child(7)  { transform: rotateY(144deg) translateZ(400px) }
    .spinner .panel:nth-child(8)  { transform: rotateY(168deg) translateZ(400px) }
    .spinner .panel:nth-child(9)  { transform: rotateY(192deg) translateZ(400px) }
    .spinner .panel:nth-child(10) { transform: rotateY(216deg) translateZ(400px) }
    .spinner .panel:nth-child(11) { transform: rotateY(240deg) translateZ(400px) }
    .spinner .panel:nth-child(12) { transform: rotateY(264deg) translateZ(400px) }
    .spinner .panel:nth-child(13) { transform: rotateY(288deg) translateZ(400px) }
    .spinner .panel:nth-child(14) { transform: rotateY(312deg) translateZ(400px) }
    .spinner .panel:nth-child(15) { transform: rotateY(336deg) translateZ(400px) }

    .fade {
      background:linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 30%, rgba(0,0,0,.35) 70%, rgba(0,0,0,0) 100%);
      width:900px; height:220px; position:absolute; z-index:2; pointer-events:none;
      transform: rotateY(calc(var(--ang) * -1deg)) translateZ(110px);
      transition: all .5s ease-in-out;
    }

    .pagination {
      position:absolute; top:50%; left:0; right:0; transform:translateY(-50%);
      display:flex; justify-content:space-between; z-index:3;
    }
    .pagination button{
      width:44px; height:44px; border-radius:999px; border:none; cursor:pointer;
      background:#fff8; color:#000; font-size:20px;
    }
    .pagination button:hover{ background:#fff }

    /* Portadas (fallback; se sobreescriben con JSON si existe) */
    .a{ background-image:url(https://images.unsplash.com/photo-1516727003284-a96541e51e9c?auto=format&q=85) }
    .b{ background-image:url(https://images.unsplash.com/photo-1691389694412-266f872999c6?auto=format&q=85) }
    .c{ background-image:url(https://images.unsplash.com/photo-1606391901318-07003db08d63?auto=format&q=85) }
    .d{ background-image:url(https://images.unsplash.com/photo-1610785396756-24bd1889ddae?auto=format&q=85) }
    .e{ background-image:url(https://images.unsplash.com/photo-1505849871170-7f94cf84f4d2?auto=format&q=85) }

    /* === MODAL Reproductor === */
    .overlay{
      position:fixed; inset:0; background:#000a; display:none;
      align-items:center; justify-content:center; z-index:20;
    }
    .overlay.show{ display:flex }
    .modal{
      width:min(920px, 92vw); border:1px solid #222; background:#0b0b0b;
      border-radius:16px; box-shadow:0 18px 60px #000a; position:relative; overflow:hidden;
    }
    .modal-header{
      display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #1e1e1e;
      background:linear-gradient(180deg,#121212,#0e0e0e);
    }
    .modal-title{ font-weight:800; letter-spacing:.3px }
    .modal-close{ width:36px; height:36px; border-radius:999px; border:1px solid #2a2a2a; background:#171717; color:#eee; cursor:pointer }

    .modal-body{
      display:grid; grid-template-columns: 1.1fr 1fr; gap:18px; padding:18px; position:relative;
    }
    @media (max-width: 800px){
      .modal-body{ grid-template-columns: 1fr }
    }
    .cover{
      aspect-ratio:1/1; width:100%; border-radius:12px; overflow:hidden; border:1px solid #222;
      background:#111 center/cover no-repeat;
    }

    .audio-ui{
      display:flex; flex-direction:column; gap:12px; background:#0b0b0b; border:1px solid #222; border-radius:12px; padding:14px;
    }
    .row{ display:flex; align-items:center; gap:10px }
    .au-btn{
      width:46px; height:46px; border-radius:999px; border:1px solid #2a2a2a;
      background:#171717; color:#eee; cursor:pointer; font-size:16px
    }
    .au-btn:hover{ background:#1d1d1d }
    .au-bar{ position:relative; height:10px; background:#1e1e1e; border-radius:999px; cursor:pointer; overflow:hidden; flex:1 }
    .au-fill{ position:absolute; inset:0 auto 0 0; width:0%; background:linear-gradient(90deg,#ffd783,#ffb347); border-radius:999px }
    .au-time{ width:70px; text-align:right; font-size:12px; color:#ddd }
    .au-vol{ width:140px; accent-color:#ffb347 }
    .au-open{
      align-self:flex-start; text-decoration:none; background:#ffe1a2; color:#111; border:1px solid #e7c07a;
      border-radius:10px; padding:8px 12px; font-weight:700;
    }

    /* Pocket YouTube visible (cuenta como view) */
    .pocket-yt{
      position:absolute; right:12px; bottom:12px; width:160px; height:90px; z-index:5;
      border:1px solid #2a2a2a; border-radius:10px; overflow:hidden; background:#111;
      display:flex; align-items:center; justify-content:center;
    }
    .pocket-yt__badge{
      position:absolute; top:6px; left:6px; font-size:10px; color:#111; background:#ffe1a2;
      border:1px solid #e7c07a; border-radius:6px; padding:2px 6px; font-weight:700; z-index:2
    }
    .pocket-yt iframe{ width:100%; height:100%; border:0 }
  </style>
</head>
<body>

  <header>
    <div class="logo">Tenshi</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="news.html">News</a>
      <a href="Discography.html">Discography</a>
      <a href="movie.html">Videos</a>
      <a href="wallpapers.html">Gallery</a>
    </nav>
  </header>

  <section class="hero">
    <h1>ディスコグラフィー — Discography</h1>
  </section>

  <section class="discography" id="discography">
    <div class="container">
      <div class="holder">
        <div class="spinner" id="spinner">
          <!-- 15 paneles (5 portadas * 3 vueltas) -->
          <button class="panel a" aria-label="Disco A"></button>
          <button class="panel b" aria-label="Disco B"></button>
          <button class="panel c" aria-label="Disco C"></button>
          <button class="panel d" aria-label="Disco D"></button>
          <button class="panel e" aria-label="Disco E"></button>

          <button class="panel a" aria-label="Disco A"></button>
          <button class="panel b" aria-label="Disco B"></button>
          <button class="panel c" aria-label="Disco C"></button>
          <button class="panel d" aria-label="Disco D"></button>
          <button class="panel e" aria-label="Disco E"></button>

          <button class="panel a" aria-label="Disco A"></button>
          <button class="panel b" aria-label="Disco B"></button>
          <button class="panel c" aria-label="Disco C"></button>
          <button class="panel d" aria-label="Disco D"></button>
          <button class="panel e" aria-label="Disco E"></button>

          <div class="fade"></div>
        </div>
      </div>
      <div class="pagination">
        <button type="button" id="prev">&#8592;</button>
        <button type="button" id="next">&#8594;</button>
      </div>
    </div>
  </section>

  <!-- MODAL -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Título</div>
        <button class="modal-close" id="modalClose" aria-label="Cerrar">✕</button>
      </div>

      <div class="modal-body">
        <div class="cover" id="modalCover"></div>

        <div class="audio-ui">
          <div class="row">
            <button class="au-btn" id="auPlay" aria-label="Reproducir/Pausa">▶</button>
            <div class="au-bar" id="auBar"><div class="au-fill" id="auFill"></div></div>
            <span class="au-time" id="auTime">0:00</span>
            <input class="au-vol" id="auVol" type="range" min="0" max="100" value="100" aria-label="Volumen">
          </div>
          <a class="au-open" id="auOpen" target="_blank" rel="noopener">Abrir en YouTube</a>
        </div>

        <!-- Pocket player visible -->
        <div class="pocket-yt">
          <span class="pocket-yt__badge">YouTube</span>
          <div id="pocket-yt-iframe"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery (solo para setear la variable CSS del carrusel) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    /* ==========================
       1) Carrusel 3D (igual a tu estilo)
    ===========================*/
    let ang = 0;
    const PANELS = 15;
    const STEP = 360 / PANELS; // 24°

    function updateSpinnerAngle(){
      $("*").css("--ang", ang);
    }
    $("#prev").on("click", () => { ang += STEP; updateSpinnerAngle(); });
    $("#next").on("click", () => { ang -= STEP; updateSpinnerAngle(); });
    $(document).ready(updateSpinnerAngle);

    /* =====================================================
       2) Datos de canciones (asocia clases a/b/c/d/e → videoId)
          👉 Cambia estos IDs por los tuyos
    ======================================================*/
    const TRACKS = {
      a: { title: "Track A", videoId: "rIUBxbcd_I0" }, // ejemplo
      b: { title: "Track B", videoId: "onfYQgU7PxU" }, // ejemplo
      c: { title: "Track C", videoId: "rLBeFFrjKbU" }, // ejemplo
      d: { title: "Track D", videoId: "0_QHL7cDYno" },// ejemplo
      e: { title: "Track E", videoId: "Ulj3sX_jJ7g" } // ejemplo
    };

    /* Si existe data/catalogo.json, usamos sus portadas para a..e */
    (async function tryLoadCovers(){
      try{
        const r = await fetch('data/catalogo.json', { cache:'no-store' });
        if(!r.ok) return;
        const data = await r.json();
        const covers = (data.discografia && Array.isArray(data.discografia.portadas))
          ? data.discografia.portadas.slice(0,5) : [];
        const classes = ['a','b','c','d','e'];
        classes.forEach((cls,i) => {
          const url = covers[i];
          if(!url) return;
          document.querySelectorAll('.panel.'+cls).forEach(el => {
            el.style.backgroundImage = `url('${url}')`;
          });
        });
      }catch(e){ /* noop */ }
    })();

    /* =====================================================
       3) Modal + Pocket-YouTube + Controles
    ======================================================*/
    const overlay  = document.getElementById('overlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalCover = document.getElementById('modalCover');
    const modalClose = document.getElementById('modalClose');
    const auPlay  = document.getElementById('auPlay');
    const auBar   = document.getElementById('auBar');
    const auFill  = document.getElementById('auFill');
    const auTime  = document.getElementById('auTime');
    const auVol   = document.getElementById('auVol');
    const auOpen  = document.getElementById('auOpen');

    let ytPlayer = null;
    let progressTimer = null;
    let currentVideoId = null;

    // YouTube API callback
    window.onYouTubeIframeAPIReady = function(){
      ytPlayer = new YT.Player('pocket-yt-iframe', {
        width: 160, height: 90,
        videoId: '', // se setea al abrir el modal
        playerVars: {
          controls: 1, modestbranding: 1, iv_load_policy: 3,
          rel: 0, playsinline: 1
        },
        events: {
          onReady: () => { try { ytPlayer.setVolume(100); } catch(e){} },
          onStateChange: onYTState
        }
      });
    };

    function onYTState(e){
      // 1 = playing, 2 = paused, 0 = ended
      if(e.data === YT.PlayerState.PLAYING){
        auPlay.textContent = '⏸';
        startProgressTimer();
      } else if(e.data === YT.PlayerState.PAUSED){
        auPlay.textContent = '▶';
        stopProgressTimer();
      } else if(e.data === YT.PlayerState.ENDED){
        auPlay.textContent = '▶';
        stopProgressTimer();
        setProgressUI(0, 0);
      }
    }

    function fmtTime(s){
      s = Math.max(0, Math.floor(s || 0));
      const m = Math.floor(s/60), sec = s%60;
      return `${m}:${sec.toString().padStart(2,'0')}`;
    }

    function setProgressUI(cur, dur){
      const pct = (dur>0)? (cur/dur)*100 : 0;
      auFill.style.width = `${pct}%`;
      auTime.textContent = `${fmtTime(cur)}`;
    }

    function startProgressTimer(){
      stopProgressTimer();
      progressTimer = setInterval(() => {
        if(!ytPlayer || typeof ytPlayer.getDuration !== 'function') return;
        const d = ytPlayer.getDuration() || 0;
        const c = ytPlayer.getCurrentTime() || 0;
        setProgressUI(c, d);
      }, 250);
    }
    function stopProgressTimer(){
      if(progressTimer){ clearInterval(progressTimer); progressTimer = null; }
    }

    // Controles UI → YouTube
    auPlay.addEventListener('click', () => {
      if(!ytPlayer) return;
      const state = ytPlayer.getPlayerState();
      if(state === YT.PlayerState.PLAYING){
        ytPlayer.pauseVideo();
      }else{
        ytPlayer.playVideo();
      }
    });

    auVol.addEventListener('input', () => {
      if(!ytPlayer) return;
      const v = parseInt(auVol.value, 10);
      ytPlayer.setVolume(Math.max(0, Math.min(100, v)));
    });

    auBar.addEventListener('click', (ev) => {
      if(!ytPlayer) return;
      const rect = auBar.getBoundingClientRect();
      const x = ev.clientX - rect.left;
      const pct = x / rect.width;
      const dur = ytPlayer.getDuration() || 0;
      ytPlayer.seekTo(pct * dur, true);
    });

    function openModalFor(cls, coverUrl){
      const track = TRACKS[cls] || null;
      if(!track){ return; }

      currentVideoId = track.videoId;
      modalTitle.textContent = track.title || 'Track';
      modalCover.style.backgroundImage = coverUrl ? `url('${coverUrl}')` : 'none';
      auOpen.href = `https://www.youtube.com/watch?v=${currentVideoId}`;

      overlay.classList.add('show');

      // Cargar video en el pocket player
      const ready = () => {
        try{
          ytPlayer.loadVideoById({ videoId: currentVideoId, startSeconds: 0 });
          ytPlayer.playVideo();
          auPlay.textContent = '⏸';
          auVol.value = 100;
        }catch(e){
          // Si todavía no está listo, reintenta un poquito después
          setTimeout(ready, 150);
        }
      };
      ready();
    }

    function closeModal(){
      overlay.classList.remove('show');
      stopProgressTimer();
      if(ytPlayer && typeof ytPlayer.stopVideo === 'function'){
        ytPlayer.stopVideo();
      }
    }

    modalClose.addEventListener('click', closeModal);
    overlay.addEventListener('click', (e) => {
      if(e.target === overlay) closeModal();
    });

    // Click en una tarjeta del carrusel -> abrir modal
    document.querySelectorAll('.panel').forEach(btn => {
      btn.addEventListener('click', () => {
        // Determinar clase base a/b/c/d/e del botón
        const classes = ['a','b','c','d','e'];
        const cls = classes.find(k => btn.classList.contains(k)) || 'a';

        // Obtener la portada real (inline style si fue sobreescrita por JSON)
        let bg = btn.style.backgroundImage;
        if(!bg || bg === 'none'){
          // intenta con getComputedStyle si viene de CSS
          bg = getComputedStyle(btn).backgroundImage;
        }
        let url = '';
        if(bg && bg.startsWith('url(')){
          url = bg.slice(4, -1).replaceAll('"','').replaceAll("'","");
        }

        openModalFor(cls, url);
      });
    });
  </script>
</body>
</html>
