<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Discography | Tenshi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --bg:#0b0b0b; --ink:#f5f5f5; --acc:#ffcc70;
      --panel:#101010; --bd:#1e1e1e;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Arial,sans-serif}
    a{color:inherit}

    header{
      position:sticky;top:0;z-index:10;
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 18px;background:#0f0f0f;border-bottom:1px solid #141414
    }
    .brand{font-weight:800;letter-spacing:.3px}
    .brand b{color:var(--acc)}
    nav ul{list-style:none;display:flex;gap:16px;margin:0;padding:0}
    nav a{text-decoration:none;opacity:.8}
    nav a:hover{opacity:1}

    .wrap{max-width:1100px;margin:22px auto;padding:0 16px}

    /* Grid de portadas */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap:16px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--bd);
      border-radius:12px;
      overflow:hidden;
      cursor:pointer;
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .card:hover{ transform:translateY(-2px); box-shadow:0 10px 30px #0008; }
    .cover{
      width:100%; aspect-ratio:1/1; background:#111 center/cover no-repeat;
    }
    .meta{padding:10px 12px;border-top:1px solid #151515}
    .title{font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:.95}
    .sub{font-size:12px;opacity:.65}

    /* Modal Reproductor */
    .overlay{position:fixed;inset:0;background:#000a;display:none;align-items:center;justify-content:center;z-index:1000}
    .overlay.show{display:flex}
    .modal{
      width:min(920px,92vw);
      background:#0b0b0b;border:1px solid #222;border-radius:16px;
      box-shadow:0 18px 60px #000a; overflow:hidden;
    }
    .modal-hd{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #1e1e1e;background:linear-gradient(180deg,#121212,#0e0e0e)}
    .modal-title{font-weight:800}
    .btn-x{width:36px;height:36px;border-radius:999px;border:1px solid #2a2a2a;background:#171717;color:#eee;cursor:pointer}

    .modal-bd{display:grid;grid-template-columns:1.15fr 1fr;gap:16px;padding:16px;position:relative}
    @media(max-width:800px){.modal-bd{grid-template-columns:1fr}}
    .modal-cover{aspect-ratio:1/1;width:100%;border-radius:12px;border:1px solid #222;background:#111 center/cover no-repeat}

    .audio-ui{display:flex;flex-direction:column;gap:12px;background:#0b0b0b;border:1px solid #222;border-radius:12px;padding:14px}
    .au-row{display:flex;align-items:center;gap:10px}
    .au-btn{width:46px;height:46px;border-radius:999px;border:1px solid #2a2a2a;background:#171717;color:#eee;cursor:pointer;font-size:16px}
    .au-btn:hover{background:#1d1d1d}
    .au-bar{position:relative;height:10px;background:#1e1e1e;border-radius:999px;cursor:pointer;overflow:hidden;flex:1}
    .au-fill{position:absolute;inset:0 auto 0 0;width:0%;background:linear-gradient(90deg,#ffd783,#ffb347);border-radius:999px}
    .au-time{width:70px;text-align:right;font-size:12px;color:#ddd}
    .au-vol{width:140px;accent-color:#ffb347}
    .au-open{align-self:flex-start;text-decoration:none;background:#ffe1a2;color:#111;border:1px solid #e7c07a;border-radius:10px;padding:8px 12px;font-weight:700}

    /* Pocket YouTube (muy pequeño, 96×54) */
    .pocket-yt{position:absolute;right:12px;bottom:12px;width:96px;height:54px;z-index:5;border:1px solid #2a2a2a;border-radius:8px;overflow:hidden;background:#111;display:flex;align-items:center;justify-content:center}
    .pocket-yt__badge{position:absolute;top:5px;left:5px;font-size:9px;color:#111;background:#ffe1a2;border:1px solid #e7c07a;border-radius:6px;padding:2px 5px;font-weight:700;z-index:2}
    .pocket-yt iframe{width:100%;height:100%;border:0}

    .muted{opacity:.6}
  </style>
</head>
<body>
  <header>
    <div class="brand"><b>Tenshi</b> — Discography</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li class="muted">Discography</li>
        <li><a href="movie.html">Videos</a></li>
        <li><a href="wallpapers.html">Gallery</a></li>
      </ul>
    </nav>
  </header>

  <div class="wrap">
    <h1 style="font-size:22px;margin:6px 0 16px;">Discography</h1>
    <div id="grid" class="grid" aria-live="polite"></div>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="modal">
      <div class="modal-hd">
        <div class="modal-title" id="mTitle">Track</div>
        <button class="btn-x" id="btnClose" aria-label="Cerrar">✕</button>
      </div>
      <div class="modal-bd">
        <div class="modal-cover" id="mCover"></div>

        <div class="audio-ui">
          <div class="au-row">
            <button class="au-btn" id="auPlay" aria-label="Reproducir/Pausa">▶</button>
            <div class="au-bar" id="auBar"><div class="au-fill" id="auFill"></div></div>
            <span class="au-time" id="auTime">0:00</span>
            <input class="au-vol" id="auVol" type="range" min="0" max="100" value="100" aria-label="Volumen">
          </div>
          <a class="au-open" id="auOpen" target="_blank" rel="noopener">Abrir en YouTube</a>
        </div>

        <!-- Pocket player -->
        <div class="pocket-yt">
          <span class="pocket-yt__badge">YouTube</span>
          <div id="pocket-yt-iframe"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery (opcional, para comodidad) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    /* 1) Configura aquí tus videoId para cada portada.
       El orden debe coincidir con como aparecen en el JSON (discografia.portadas). */
    const TRACKS = [
      { title: "Track 1", videoId: "rIUBxbcd_I0" },
      { title: "Track 2", videoId: "onfYQgU7PxU" },
      { title: "Track 3", videoId: "rLBeFFrjKbU" },
      { title: "Track 4", videoId: "0_QHL7cDYno" },
      { title: "Track 5", videoId: "Ulj3sX_jJ7g" },
      // agrega más si tienes más portadas…
    ];

    /* 2) Carga portadas desde data/catalogo.json (como en tu index) */
    async function cargarPortadas() {
      try {
        const resp = await fetch('data/catalogo.json', { cache:'no-store' });
        const data = await resp.json();
        const covers = (data.discografia && Array.isArray(data.discografia.portadas))
          ? data.discografia.portadas
          : [];

        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        covers.forEach((url, idx) => {
          const card = document.createElement('article');
          card.className = 'card';
          card.setAttribute('role','button');
          card.setAttribute('tabindex','0');
          card.dataset.index = idx;

          const cover = document.createElement('div');
          cover.className = 'cover';
          cover.style.backgroundImage = `url('${url}')`;

          const meta = document.createElement('div'); meta.className = 'meta';
          const t = document.createElement('div'); t.className = 'title'; t.textContent = TRACKS[idx]?.title || `Track ${idx+1}`;
          const s = document.createElement('div'); s.className = 'sub'; s.textContent = 'Click para reproducir';

          meta.appendChild(t); meta.appendChild(s);
          card.appendChild(cover); card.appendChild(meta);
          grid.appendChild(card);

          card.addEventListener('click', ()=> openModal(idx, url));
          card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); openModal(idx, url); }});
        });

      } catch(err){
        console.error('Error cargando portadas:', err);
      }
    }

    /* 3) Modal + YouTube pocket */
    const overlay = document.getElementById('overlay');
    const mTitle  = document.getElementById('mTitle');
    const mCover  = document.getElementById('mCover');
    const btnClose= document.getElementById('btnClose');
    const auPlay  = document.getElementById('auPlay');
    const auBar   = document.getElementById('auBar');
    const auFill  = document.getElementById('auFill');
    const auTime  = document.getElementById('auTime');
    const auVol   = document.getElementById('auVol');
    const auOpen  = document.getElementById('auOpen');

    let ytPlayer = null;
    let progressTimer = null;

    window.onYouTubeIframeAPIReady = function(){
      ytPlayer = new YT.Player('pocket-yt-iframe', {
        width: 96, height: 54,
        videoId: '',
        playerVars: { controls:1, modestbranding:1, iv_load_policy:3, rel:0, playsinline:1 },
        events: { onReady: ()=>{try{ ytPlayer.setVolume(100);}catch{}}, onStateChange: onYTState }
      });
    };

    function onYTState(e){
      if(e.data === YT.PlayerState.PLAYING){ auPlay.textContent = '⏸'; startProgressTimer(); }
      else if(e.data === YT.PlayerState.PAUSED){ auPlay.textContent = '▶'; stopProgressTimer(); }
      else if(e.data === YT.PlayerState.ENDED){ auPlay.textContent = '▶'; stopProgressTimer(); setProgressUI(0, ytPlayer.getDuration()||0); }
    }

    function fmtTime(s){ s=Math.max(0,Math.floor(s||0)); const m=Math.floor(s/60),sec=s%60; return `${m}:${sec.toString().padStart(2,'0')}`; }
    function setProgressUI(cur,dur){ auFill.style.width = `${dur>0?(cur/dur)*100:0}%`; auTime.textContent = fmtTime(cur); }
    function startProgressTimer(){ stopProgressTimer(); progressTimer = setInterval(()=>{ if(!ytPlayer) return; setProgressUI(ytPlayer.getCurrentTime()||0, ytPlayer.getDuration()||0); }, 250); }
    function stopProgressTimer(){ if(progressTimer){ clearInterval(progressTimer); progressTimer=null; } }

    function openModal(idx, coverUrl){
      const track = TRACKS[idx] || { title:`Track ${idx+1}`, videoId:'' };
      mTitle.textContent = track.title;
      mCover.style.backgroundImage = `url('${coverUrl}')`;
      auOpen.href = track.videoId ? `https://www.youtube.com/watch?v=${track.videoId}` : '#';

      overlay.classList.add('show');

      const load = ()=> {
        try{
          if(track.videoId){
            ytPlayer.loadVideoById({ videoId: track.videoId, startSeconds: 0 });
            ytPlayer.playVideo();
            auPlay.textContent = '⏸';
            auVol.value = 100;
          }
        }catch{ setTimeout(load, 150); }
      };
      load();
    }

    function closeModal(){
      overlay.classList.remove('show');
      stopProgressTimer();
      if(ytPlayer){ try{ ytPlayer.stopVideo(); }catch{} }
    }
    btnClose.addEventListener('click', closeModal);
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeModal(); });

    auPlay.addEventListener('click', ()=>{
      if(!ytPlayer) return;
      const st = ytPlayer.getPlayerState();
      (st===YT.PlayerState.PLAYING) ? ytPlayer.pauseVideo() : ytPlayer.playVideo();
    });
    auVol.addEventListener('input', ()=>{ if(ytPlayer) ytPlayer.setVolume(Math.max(0,Math.min(100,parseInt(auVol.value,10)))); });
    auBar.addEventListener('click', ev=>{
      if(!ytPlayer) return;
      const rect = auBar.getBoundingClientRect();
      const pct = (ev.clientX - rect.left) / rect.width;
      ytPlayer.seekTo(pct * (ytPlayer.getDuration()||0), true);
    });

    // Init
    document.addEventListener('DOMContentLoaded', cargarPortadas);
  </script>
</body>
</html>
