<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tenshi | Spotify Embed</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; padding:24px;
      background:#0b0b0b; color:#f5f5f5;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }
    .wrap{max-width:1000px;margin:0 auto}
    h1{font-size:22px;margin:0 0 16px}
    p{opacity:.85;margin:0 0 18px}
    .card{
      background:#111; border:1px solid #222; border-radius:14px;
      padding:16px; box-shadow:0 12px 32px rgba(0,0,0,.35);
    }
    .row{display:grid; gap:12px; grid-template-columns: 1fr; margin:0 0 16px}
    input{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid #2a2a2a;
      background:#0e0e0e; color:#fff; outline:none; font-size:14px;
    }
    .btn{
      border:none; border-radius:10px; background:#1DB954; color:#101;
      padding:10px 14px; cursor:pointer; font-weight:700;
    }
    .btn:active{transform:translateY(1px)}
    .hint{font-size:12px; opacity:.7}
    .iframe-wrap{margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Spotify — Embed (artista / álbum / playlist / track)</h1>
    <p>Pega cualquier URL de Spotify. Se renderiza la tarjeta/preview y reproduce si el usuario tiene sesión en Spotify.</p>

    <div class="card">
      <div class="row">
        <label for="inUrl">URL de Spotify</label>
        <input id="inUrl" placeholder="https://open.spotify.com/artist/... / album/... / playlist/... / track/..." />
        <div class="hint">Ejemplo (artista): https://open.spotify.com/intl-es/artist/0ZkxChUDjvBph9f7TitfMR?si=pUSX6sy-TdKKtLrlgKmfHw</div>
      </div>

      <div class="row">
        <button class="btn" id="btnRender">Renderizar</button>
      </div>

      <div id="spotify-embed" class="iframe-wrap"></div>
    </div>
  </div>

  <script>
    // Convierte cualquier URL de Spotify en su URL de embed (artist/album/playlist/track)
    function spotifyEmbedFromUrl(url, opts = { theme: 'dark', height: 152 }) {
      const m = String(url).match(
        /^https?:\/\/open\.spotify\.com\/(?:intl-[^/]+\/)?(track|album|artist|playlist)\/([A-Za-z0-9]+)(?:\?.*)?$/
      );
      if (!m) return null;
      const type = m[1];
      const id   = m[2];
      const themeParam = (opts.theme === 'light') ? '1' : '0';
      const height     = Number(opts.height) || 152; // 152 tarjeta, 352 grande; tracks pueden ir a 80
      return {
        src: `https://open.spotify.com/embed/${type}/${id}?utm_source=generator&theme=${themeParam}`,
        height
      };
    }

    // Carga inicial con tu artista (puedes cambiar esta constante por cualquier recurso de Spotify)
    const DEFAULT_URL = 'https://open.spotify.com/intl-es/artist/0ZkxChUDjvBph9f7TitfMR?si=pUSX6sy-TdKKtLrlgKmfHw';

    function renderEmbed(url) {
      const embed = spotifyEmbedFromUrl(url, { theme: 'dark', height: 152 });
      const box = document.getElementById('spotify-embed');
      if (!embed) {
        box.innerHTML = '<p style="opacity:.8">URL de Spotify no válida.</p>';
        return;
      }
      box.innerHTML =
        `<iframe style="border-radius:12px"
                 src="${embed.src}"
                 width="100%" height="${embed.height}"
                 frameborder="0"
                 allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                 loading="lazy"></iframe>`;
    }

    document.getElementById('btnRender').addEventListener('click', () => {
      const v = document.getElementById('inUrl').value.trim();
      renderEmbed(v || DEFAULT_URL);
    });

    // Render inicial
    document.getElementById('inUrl').value = DEFAULT_URL;
    renderEmbed(DEFAULT_URL);
  </script>
</body>
</html>
