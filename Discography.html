<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tenshi — Discography</title>

<style>
  :root { color-scheme: dark; }
  *{box-sizing:border-box}
  body{
    margin:0; background:#0b0b0b; color:#eee;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  }

  /* Cabecera */
  .hero{
    max-width:980px; margin:48px auto 10px; padding:0 16px; text-align:center;
  }
  .title{
    font-size:34px; font-weight:900; letter-spacing:.5px; margin:16px 0 4px;
  }
  .subtitle{ opacity:.7; font-size:12px; letter-spacing: .2em; }

  /* Filtros */
  .filters{
    display:flex; gap:8px; justify-content:center; flex-wrap:wrap;
    margin:16px auto 26px;
  }
  .chip{
    border:1px solid #2a2a2a; background:#121212; color:#dfe6eb;
    padding:6px 10px; border-radius:999px; font-size:12px; cursor:pointer;
  }
  .chip.active{ border-color:#ffcc70; color:#111; background:#ffcc70; }

  /* Grilla */
  .grid{
    max-width:980px; margin:0 auto 80px; padding:0 16px;
    display:grid; grid-template-columns: repeat(3, 1fr); gap:28px 24px;
  }
  @media (max-width:900px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
  @media (max-width:580px){ .grid{ grid-template-columns: 1fr; } }

  .card{
    background:#111; border:1px solid #222; border-radius:12px; overflow:hidden;
    box-shadow:0 16px 40px rgba(0,0,0,.4);
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .card:hover{ transform:translateY(-2px); box-shadow:0 22px 46px rgba(0,0,0,.55); }
  .thumb{
    position:relative; width:100%; aspect-ratio:1 / 1; background:#0e0e0e;
    background-size:cover; background-position:center;
  }
  .meta{ padding:10px 12px 12px; text-align:center; }
  .date{ opacity:.6; font-size:10px; margin-bottom:6px; }
  .name{ font-size:13px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  /* Modal */
  .modal{
    position:fixed; inset:0; display:none; place-items:center;
    background:rgba(0,0,0,.65); z-index:50; padding:20px;
  }
  .modal.open{ display:grid; }
  .sheet{
    width:min(980px, 96vw); background:#0f0f0f; border:1px solid #222; border-radius:14px;
    box-shadow:0 30px 80px rgba(0,0,0,.7); overflow:hidden;
  }
  .sheet-head{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 16px; border-bottom:1px solid #202020; background:#111;
  }
  .sheet-title{ font-weight:800; font-size:16px }
  .close{ border:none; border-radius:8px; background:#222; color:#eee; padding:6px 10px; cursor:pointer; }
  .close:hover{ background:#333; }
  .sheet-body{
    display:grid; grid-template-columns: 1.1fr 1fr; gap:14px; padding:16px;
  }
  @media (max-width:820px){ .sheet-body{ grid-template-columns: 1fr; } }

  .cover{
    width:100%; aspect-ratio:1/1; border-radius:10px; border:1px solid #222;
    background:#0d0d0d center/cover no-repeat;
  }
  .player{
    background:#111; border:1px solid #222; border-radius:12px; padding:12px;
  }
  .player h4{ margin:0 0 12px; font-size:14px; opacity:.9 }
  .btn-yt{
    display:inline-block; background:#ffcc70; color:#111; border:none; border-radius:10px;
    padding:9px 12px; font-weight:800; text-decoration:none;
  }
  .btn-yt:hover{ filter:brightness(1.05); }
  .note{ font-size:12px; opacity:.7; margin-top:10px }
</style>
</head>
<body>

  <!-- Cabecera -->
  <div class="hero">
    <div class="title">DISCOGRAPHY</div>
    <div class="subtitle">ディスコグラフィー</div>

    <!-- Filtros -->
    <div class="filters" id="filters">
      <button class="chip active" data-type="all">ALL</button>
      <button class="chip" data-type="digital">DIGITAL</button>
      <button class="chip" data-type="single">SINGLE</button>
      <button class="chip" data-type="ep">EP</button>
      <button class="chip" data-type="album">ALBUM</button>
    </div>
  </div>

  <!-- Grilla -->
  <div class="grid" id="grid"></div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="sheet">
      <div class="sheet-head">
        <div class="sheet-title" id="mTitle">Track title</div>
        <button class="close" id="btnClose">✕</button>
      </div>
      <div class="sheet-body">
        <div class="cover" id="mCover"></div>
        <div class="player" id="mPlayer">
          <!-- Se inyecta SOLO un reproductor (Spotify tiene prioridad; si no, YouTube) -->
        </div>
      </div>
    </div>
  </div>

<script>
/* ========= 1) DATA (EDITA AQUÍ) =========
   type: "digital" | "single" | "ep" | "album"
   Solo UNA fuente por casilla:
   - Spotify:  urlSpotify: "https://open.spotify.com/track/..."
   - YouTube:  urlYouTube: "https://www.youtube.com/watch?v=..."
   (Si pones ambos, se usará Spotify y se ignora YouTube) */
const DISCO = [
  {
    type: "single",
    title: "Answer",
    date: "2024-03-21",
    cover: "https://images.unsplash.com/photo-1535930749574-1399327ce78f?q=80&w=1000&auto=format",
    urlSpotify: "https://open.spotify.com/track/2X5mC2tQbDPo3v7y1w5gMc"
    // urlYouTube: "https://www.youtube.com/watch?v=XXXXXXXXXXX"
  },
  {
    type: "digital",
    title: "Kumo",
    date: "2023-11-10",
    cover: "https://images.unsplash.com/photo-1549887534-1541e9326642?q=80&w=1000&auto=format",
    urlSpotify: "https://open.spotify.com/track/5f8bH58v5b1y1Jf3y2Kc6m"
  },
  {
    type: "ep",
    title: "Midnight Glow (EP)",
    date: "2023-09-02",
    cover: "https://images.unsplash.com/photo-1520975897072-1d8a2be4cfd5?q=80&w=1000&auto=format",
    urlSpotify: "https://open.spotify.com/album/4bS8d8hJ7h8Ff2wq6aE9mN"
  },
  {
    type: "single",
    title: "Blue City",
    date: "2023-06-10",
    cover: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1000&auto=format",
    urlSpotify: "https://open.spotify.com/track/6rqhFgbbKwnb9MLmUQDhG6"
  },
  {
    type: "album",
    title: "Neon Diary",
    date: "2022-12-01",
    cover: "https://images.unsplash.com/photo-1520697222861-8c52fe3f0b9a?q=80&w=1000&auto=format",
    urlSpotify: "https://open.spotify.com/album/6QPkyl04rXwTGlGlcYaRoW"
  },
  {
    type: "digital",
    title: "Hikari",
    date: "2022-08-14",
    cover: "https://images.unsplash.com/photo-1534338580013-382cf48bd435?q=80&w=1000&auto=format",
    // Si prefieres YouTube SOLO en esta casilla, comenta urlSpotify y descomenta urlYouTube:
    // urlSpotify: "",
    urlYouTube: "https://www.youtube.com/watch?v=QH2-TGUlwu4"
  }
];

/* ========= 2) RENDER GRID ========= */
const grid = document.getElementById('grid');
const filters = document.getElementById('filters');

let currentType = 'all';

function formatDate(s){
  if(!s) return '';
  try{
    const d = new Date(s);
    return d.toLocaleDateString('es-CL', { year: 'numeric', month: 'short', day: '2-digit' });
  }catch{ return s; }
}

function renderGrid(){
  const list = DISCO.filter(it => currentType==='all' ? true : it.type===currentType);
  grid.innerHTML = '';
  list.forEach((it, i) => {
    const card = document.createElement('button');
    card.className = 'card';
    card.style.cursor = 'pointer';
    card.setAttribute('aria-label', `Abrir ${it.title}`);
    card.innerHTML = `
      <div class="thumb" style="background-image:url('${it.cover}')"></div>
      <div class="meta">
        <div class="date">${formatDate(it.date)}</div>
        <div class="name" title="${it.title}">${it.title}</div>
      </div>
    `;
    card.addEventListener('click', () => openModal(it));
    grid.appendChild(card);
  });
}
filters.addEventListener('click', (e)=>{
  const btn = e.target.closest('.chip'); if(!btn) return;
  filters.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  btn.classList.add('active');
  currentType = btn.dataset.type || 'all';
  renderGrid();
});
renderGrid();

/* ========= 3) MODAL + PLAYER (solo uno) ========= */
const modal = document.getElementById('modal');
const mTitle = document.getElementById('mTitle');
const mCover = document.getElementById('mCover');
const mPlayer = document.getElementById('mPlayer');
document.getElementById('btnClose').onclick = ()=> closeModal();
modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

function closeModal(){
  modal.classList.remove('open');
  mPlayer.innerHTML = '';
}

/* Spotify embed helper */
function toSpotifyEmbed(url, theme='dark', height=152){
  const m = String(url).match(/^https?:\/\/open\.spotify\.com\/(?:intl-[^/]+\/)?(track|album|artist|playlist)\/([A-Za-z0-9]+)(?:\?.*)?$/);
  if(!m) return null;
  const type = m[1], id = m[2];
  const themeParam = (theme==='light') ? '1' : '0';
  return `https://open.spotify.com/embed/${type}/${id}?utm_source=generator&theme=${themeParam}`;
}

/* YouTube embed helper */
function toYoutubeEmbed(url){
  // Soporta enlaces watch y youtu.be
  const idMatch = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:\?|&|$)/);
  if(!idMatch) return null;
  return `https://www.youtube.com/embed/${idMatch[1]}?autoplay=1&modestbranding=1&rel=0`;
}

/* Reproductor modal: SOLO UNO por casilla */
function openModal(item){
  mTitle.textContent = item.title || 'Track';
  mCover.style.backgroundImage = `url('${item.cover}')`;

  mPlayer.innerHTML = ''; // limpio
  // Prioridad Spotify, si no hay -> YouTube
  if(item.urlSpotify){
    const src = toSpotifyEmbed(item.urlSpotify, 'dark', 152);
    if(src){
      mPlayer.innerHTML = `
        <h4>Reproducir</h4>
        <iframe style="border-radius:12px" src="${src}" width="100%" height="152"
          frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
          loading="lazy"></iframe>
        <p class="note">Vista previa de Spotify (si la sesión está iniciada podrás escuchar completa según permisos/licencias).</p>
      `;
    }
  } else if(item.urlYouTube){
    const src = toYoutubeEmbed(item.urlYouTube);
    if(src){
      /* Mostramos el player YouTube, SIN controles de “más videos” pero visible (no lo escondemos) */
      mPlayer.innerHTML = `
        <h4>Reproducir</h4>
        <div style="position:relative; padding-top:56.25%; border-radius:12px; overflow:hidden; border:1px solid #222">
          <iframe src="${src}" style="position:absolute; inset:0; width:100%; height:100%; border:0;"
           allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
        </div>
        <p class="note">Reproducción desde YouTube.</p>
      `;
    }
  } else {
    mPlayer.innerHTML = `<p class="note">Esta entrada no tiene un enlace de reproducción configurado.</p>`;
  }

  modal.classList.add('open');
}
</script>
</body>
</html>
